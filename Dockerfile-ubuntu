FROM ubuntu:22.04

RUN apt update -y \
 && apt install -y default-jdk maven wget ca-certificates \
 && rm -rf /var/lib/apt/lists/*

# Download Tomcat
ENV TOMCAT_VER=9.0.8
WORKDIR /opt
RUN wget -q https://archive.apache.org/dist/tomcat/tomcat-9/v${TOMCAT_VER}/bin/apache-tomcat-${TOMCAT_VER}.tar.gz \
 && tar -xzf apache-tomcat-${TOMCAT_VER}.tar.gz -C /opt \
 && ln -sfn /opt/apache-tomcat-${TOMCAT_VER} /opt/tomcat

# Create tomcat user (no login) and set ownership (no 777)
RUN groupadd -r tomcat \
 && useradd -r -g tomcat -d /opt/tomcat -s /usr/sbin/nologin tomcat \
 && chown -R tomcat:tomcat /opt/apache-tomcat-${TOMCAT_VER}

# Deploy your WAR (example path)
WORKDIR /opt/tomcat/webapps
COPY target/java-tomcat-maven-example.war ./ROOT.war

EXPOSE 8080
USER tomcat
CMD ["/opt/tomcat/bin/catalina.sh", "run"]
